<!DOCTYPE HTML>
<html>
<link rel="stylesheet" href="../static/css/style.css">
<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>
<body>
<div class="container">
  <div>
    <h1>URL Shortener</h1>

    <div id="inputDiv">
      <input type="text" id="originUrl" name="originUrl" placeholder="url 입력" size="150">
      <input value="SHORTEN!" type="button" onclick="getResult()">
    </div>

    <div id="result">
    </div>
  </div>
</div>
</body>

<script>
  function getResult() {
    var data = { originUrl: $("#originUrl").val() }

    $.ajax({
      url: "/shorten-URL",
      data: JSON.stringify(data),
      type:"POST",
      contentType: 'application/json; charset=utf-8',
      dataType: "text"
    }).done(function(result) {
      let parse = JSON.parse(result);
      let response = "<p>shorten url: <a href=" +$("#originUrl").val() +" target='_blank'>" + parse.shortenUrl +"</a></p>";
      // todo : 현재까지 단축된 url들 표시하여 그 링크로는 get api를 통해 redirect를 할 수 있도록
      $("#result").empty();
      $("#result").append(response);
    }).fail(function() {
      let response = "<p>[변환 실패] URL 형식으로 입력해야합니다.</p>";
      // todo : url validated 형식 알아보기, url validated connection 확인하는 로직 추가
      $("#result").empty();
      $("#result").append(response);
    })
  }
</script>
</html>